// Controller for Single Object Page
// Globals
////////////////////////////////////////////////////////////////////////////////////////////////////////////////
function APIcall(e){function n(e){console.log(e);APIdata=e;if(APIdata.getObjectXML.object_status=="Inactive"||APIdata.getObjectXML.object_status=="Absent")loadError();else{makeTranslations();renderPage()}}function r(e){console.log("API Call unsuccessful.  Back to the drawing board.");loadError()}var t="http://silo.lib.wayne.edu/WSUAPI?functions[]=getObjectXML&functions[]=hasMemberOf&functions[]=isMemberOfCollection&functions[]=solrGetFedDoc&PID="+e;$.ajax({url:t,dataType:"json",success:n,error:r})}function loadError(){$("#container").empty();var e='<h3 style="text-align:center;">Could not find Object in WSUDOR.</h3>',t=Mustache.to_html(e,APIdata);$("#container").html(t);$("#container").show()}function makeTranslations(){APIdata.translated=new Object;APIdata.translated.contentModelPretty=rosetta(APIdata.solrGetFedDoc.response.docs[0].rels_preferredContentModel[0])}function renderPage(){$(document).ready(function(){$.Mustache.addFromDom();$("head").mustache("head_t",APIdata);$.get("templates/info-panel.htm",function(e){var t=Mustache.to_html(e,APIdata);$(".info-panel").html(t)});$.get("templates/display-more-info.htm",function(e){var t=Mustache.to_html(e,APIdata);$(".display-more-info table").html(t)});APIdata.hasMemberOf.results.length>0?$("#children").mustache("children_t",APIdata):$("#children").append("<p>This object has no sub-components.</p>");APIdata.isMemberOfCollection.results.length>0?$("#parents").mustache("parents_t",APIdata):$("#parents").append("<p>This object is not part of any collections.</p>")});finishRendering()}function finishRendering(){function e(){$.get("templates/singleObject/unknownType.htm",function(e){var t=Mustache.to_html(e,APIdata);$(".primary-object-container").html(t)})}if(APIdata.solrGetFedDoc.response.docs[0].rels_preferredContentModel!=undefined){ctype=APIdata.translated.contentModelPretty;switch(ctype){case"Image":$.get("templates/singleObject/image.htm",function(e){var t=Mustache.to_html(e,APIdata);$(".primary-object-container").html(t)});break;case"ComplexImage":$.get("templates/singleObject/complexImage.htm",function(e){var t=Mustache.to_html(e,APIdata);$(".primary-object-container").html(t)});break;case"WSUebook":$.get("templates/singleObject/WSUebook.htm",function(e){var t=Mustache.to_html(e,APIdata);$(".primary-object-container").html(t)});break;case"Collection":$.get("templates/singleObject/collection.htm",function(e){var t=Mustache.to_html(e,APIdata);$(".primary-object-container").html(t)});break;case"Audio":$.get("templates/singleObject/audio.htm",function(e){var t=Mustache.to_html(e,APIdata);$(".primary-object-container").html(t)});break;case"Document":e();break;case"Video":$.get("templates/singleObject/video.htm",function(e){var t=Mustache.to_html(e,APIdata);$(".primary-object-container").html(t)});break;case"Archive":e();break;default:e()}}else e()}function addFav(){if(typeof userData.username_WSUDOR!="undefined"){var e=new Object;e.id=userData.username_WSUDOR+"_"+APIdata.APIParams.PID;e.fav_user=userData.username_WSUDOR;e.fav_item=APIdata.APIParams.PID;var t="["+JSON.stringify(e)+"]";console.log(t);var n="http://silo.lib.wayne.edu/WSUAPI?functions[]=solrAddDoc&raw="+t;console.log(n);$.ajax({url:n,dataType:"json",success:r,error:i});function r(e){console.log(e);e.solrAddDoc.responseHeader.status==0?alert("Favorite Added!"):alert("Error")}function i(e){console.log(e);alert("Error.")}}else alert("No user defined!")}function updateLargeView(e,t){$("#LargeView a img").attr("src","http://silo.lib.wayne.edu/imageServer?imgURL=http://silo.lib.wayne.edu/fedora/objects/"+t+"/datastreams/PREVIEW/content&aspectResize=(1024x768)");$("#LargeView a").attr("href","http://silo.lib.wayne.edu/imageServer?imgURL=http://silo.lib.wayne.edu/fedora/objects/"+t+"/datastreams/ACCESS/content")}var APIdata=new Object;$(document).ready(function(){$("#container").show()});