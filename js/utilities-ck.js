// UTILITIES
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/**
 * http://stackoverflow.com/a/10997390/11236
 */function updateURLParameter(e,t,n){var r="",s=e.split("?"),o=s[0],u=s[1],a="";if(u){s=u.split("&");for(i=0;i<s.length;i++)if(s[i].split("=")[0]!=t){r+=a+s[i];a="&"}}var f=a+""+t+"="+n;return o+"?"+r+f}function debugSearchParams(){console.log("searchParams:");console.log(searchParams);console.log("searchDefs:");console.log(searchDefs);console.log("mergedParams:");console.log(mergedParams)}function removeParameter(e,t){var n=e.split("#"),r=n[0].split("?");if(r.length>=2){var i=r.shift(),s=r.join("?"),o=encodeURIComponent(t)+"=",u=s.split(/[&;]/g);for(var a=u.length;a-->0;)u[a].lastIndexOf(o,0)!==-1&&u.splice(a,1);e=i+"?"+u.join("&");n[1]&&(e+="#"+n[1])}e=URLcleaner(e);return e}function facetCollapseToggle(e,t){$("#"+t+"_less").toggle();$("#"+t+"_more").toggle();e=="more"&&$("#"+t+"_list.facet_list li.hidden_facet").fadeIn();e=="less"&&$("#"+t+"_list.facet_list li.hidden_facet").hide()}function mix(e,t){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}function URLcleaner(e){e=e.replace(/[&]+/g,"&");while(e.endsWith("?q="))e=e.substring(0,e.length-3);while(e.endsWith("?q=*"))e=e.substring(0,e.length-4);while(e.endsWith("?")||e.endsWith("&"))e=e.substring(0,e.length-1);return e}function refineByKeyWord(e){var t=window.location.href,n=$("#filter_input").val();if(e=="search"){t.indexOf("?q=")==-1&&(t+="?q=*");t.endsWith("?q=")==1&&(t+="*")}var r=t+"&fq[]=text:"+n+"&start=0";r=URLcleaner(r);window.location=r}function showFacets(){var e=document.URL;for(var t=0;t<mergedParams["fq[]"].length;t++){var n=mergedParams["fq[]"][t],r=n.split(":")[0],i=n.split(":").slice(1).join(":"),s=e.replace("fq[]="+encodeURI(n),"");s=URLcleaner(s);$(".filtered-by").append("<span class='facet-item'><a href='"+s+"'>x "+rosetta(i)+"</a></span>")}}function updateNumbers(){$("#q_string").html(mergedParams.q);$("#num_results").html(APIdata.solrSearch.response.numFound);$("#rows").val(mergedParams.rows).prop("selected",!0)}function paginationUpdate(){var e=tpagesPaginate(APIdata.solrSearch.response.numFound,mergedParams.rows),t=parseInt(mergedParams.start/mergedParams.rows)+1;t==0&&(t=1);$(".pagination-centered").bootpag({total:e,page:t,maxVisible:10,leaps:!1}).on("page",function(e,t){var n=updateURLParameter(window.location.href,"start",t*mergedParams.rows-mergedParams.rows);window.location=n})}function populateFacets(){var e=document.URL;e.indexOf("?q=")==-1&&(e+="?q=*");e.endsWith("?q=")==1&&(e+="*");var t=18;for(var n in APIdata.solrSearch.facet_counts.facet_fields){$("#facets_container").append("<ul class='facet_container filter' id='"+n+"_facet'><li><h3 class='tree-toggler'><span>&#9660;</span>"+rosetta(n)+"</h3><ul class='tree facet_list' id='"+n+"_list'></ul></li>");var r=APIdata.solrSearch.facet_counts.facet_fields[n];for(var i=0;i<r.length;i+=2){var s=rosetta(r[i]);if(r[i]!=""){fURL=e+"&fq[]="+n+':"'+r[i]+'"';fURL.contains("start=")?fURL=fURL.replace(/start=([0-9]+)/g,"start=0"):fURL+="&start=0";if(i>t)var o="class='hidden_facet'";else var o="";$("#"+n+"_list").append("<li "+o+"><a href='"+fURL+"'>"+s+" ("+r[i+1]+")</a></li>")}}if(r.length>t){$("#"+n+"_list").append("<p class='facet-more'><strong><a id='"+n+"_more' href='#' onclick='facetCollapseToggle(\"more\", \""+n+"\"); return false;'>View All &raquo;</a></strong></p>");$("#"+n+"_list").append("<p class='facet-more'><strong><a class='facet_less' id='"+n+"_less' href='#' onclick='facetCollapseToggle(\"less\", \""+n+"\"); return false;'>&laquo; View Less</a></strong></p>")}}}function populateResults(e,t,n){for(var r=0;r<APIdata.solrSearch.response.docs.length;r++)$.ajax({url:e,dataType:"html",async:!1,success:function(e){var s=e;if(typeof n=="undefined")var o=Mustache.to_html(s,APIdata.solrSearch.response.docs[r]);else var o=Mustache.to_html(s,n);$(t).append(o)}})}function renderSerialNavBlock(){function e(e){var t={},n=[],r=[],i={};for(var s=0;s<e.length;s++){var o=e[s];if(r.indexOf(o.volume)==-1){r.push(o.volume);i[o.volume]=o.volumeTitle}if(t.hasOwnProperty(o.volume)==0){t[o.volume]=[];var u={};u.issuePID=o.issue;u.issueTitle=o.issueTitle;t[o.volume].push(u)}else{var u={};u.issuePID=o.issue;u.issueTitle=o.issueTitle;t[o.volume].push(u)}}APIdata.serialMeta.keyVols=t;r.alphanumSort();APIdata.sortingArray=r;for(var s=0;s<APIdata.sortingArray.length;s++){var a={};a.volPID=APIdata.sortingArray[s];a.volTitle=i[APIdata.sortingArray[s]];a.issuesArray=t[APIdata.sortingArray[s]];n.push(a)}APIdata.serialMeta.volNames=i;APIdata.serialMeta.cleanVols=n}e(APIdata.serialMeta.serialWalk.results);$.ajax({url:"templates/serial-nav-full.htm",dataType:"html",async:!0,success:function(e){var t=e,n=Mustache.to_html(t,APIdata);$("#serial-nav").append(n);renderMain()}})}function cleanEmptyMetaRows(){var e=$("td");e.each(function(e,t){var n=$(t).html();$.trim($(t).html())==""&&$(t).parent().hide()})}function tpagesPaginate(e,t){var n=e/t;return n%1!=0?parseInt(n)+1:n}String.prototype.contains=function(e){return this.indexOf(e)!=-1};String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1};String.prototype.stripFedRDFPrefix=function(){return this.substring(12)};Array.prototype.alphanumSort=function(e){for(var t=0,n;n=this[t];t++){this[t]=[];var r=0,i=-1,s=0,o,u;while(o=(u=n.charAt(r++)).charCodeAt(0)){var a=o==46||o>=48&&o<=57;if(a!==s){this[t][++i]="";s=a}this[t][i]+=u}}this.sort(function(t,n){for(var r=0,i,s;(i=t[r])&&(s=n[r]);r++){if(e){i=i.toLowerCase();s=s.toLowerCase()}if(i!==s){var o=Number(i),u=Number(s);return o==i&&u==s?o-u:i>s?1:-1}}return t.length-n.length});for(var t=0;t<this.length;t++)this[t]=this[t].join("")};