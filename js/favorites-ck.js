// Javascript for favorites view
// Variables
//////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Default Search Parameters (pre form submission)
function getFavs(){function n(e){APIdata.favs=e;console.log(userData.username_WSUDOR+" favorites:");console.log(e);searchGo()}function r(e){console.log("API Call unsuccessful.  Back to the drawing board.")}var e=new Object;e.q="fav_user:"+userData.username_WSUDOR;e.fl="fav_item";typeof searchParams.start!="undefined"?e.start=searchParams.start:searchParams.start=0;e.rows=searchParams.rows;e.facet="false";e.raw="noescape";mergedParams=jQuery.extend(!0,{},searchDefs,e);console.log("Merged FAVs Params:",mergedParams);solrParamsString=JSON.stringify(mergedParams);var t="http://silo.lib.wayne.edu/WSUAPI?functions[]=getUserFavorites&solrParams="+solrParamsString;console.log(t);$.ajax({url:t,dataType:"json",success:n,error:r})}function updatePage(){var e=document.URL;$("#fav_user").html(userData.displayName);$("#num_results").html(APIdata.favs.getUserFavorites.response.numFound);var t=tpagesPaginate(APIdata.favs.getUserFavorites.response.numFound,mergedParams.rows),n=parseInt(mergedParams.start/mergedParams.rows)+1;n==0&&(n=1);$(".pagination-centered").bootpag({total:t,page:n,maxVisible:10,leaps:!0}).on("page",function(e,t){var n=updateURLParameter(window.location.href,"start",t*mergedParams.rows-mergedParams.rows);window.location=n})}function searchGo(){function i(e){mix(e,APIdata);console.log("APIdata");console.log(APIdata);$(document).ready(function(){updatePage();populateResults()})}function s(e){console.log("API Call unsuccessful.  Back to the drawing board.")}searchParams.q="";for(var e=0;e<APIdata.favs.getUserFavorites.response.docs.length;e++){var t=APIdata.favs.getUserFavorites.response.docs[e].fav_item;searchParams.q+=t+" "}var n=searchParams.start;searchParams.start=0;searchParams["fq[]"]=searchParams.fq;delete searchParams.fq;mergedParams=jQuery.extend(!0,{},searchDefs,searchParams);debugSearchParams();solrParamsString=JSON.stringify(mergedParams);var r="http://silo.lib.wayne.edu/WSUAPI?functions[]=solrSearch&solrParams="+solrParamsString;searchParams.start=n;mergedParams.start=n;$.ajax({url:r,dataType:"json",success:i,error:s})}function updateSearch(){var e=window.location.href;searchParams.rows=$("#rows").val();var e=updateURLParameter(e,"rows",searchParams.rows);if(searchParams.rows>searchParams.start)var e=updateURLParameter(e,"start","0");window.location=e}function populateResults(){for(var e=0;e<APIdata.solrSearch.response.docs.length;e++)$.ajax({url:"templates/favoritesObj.htm",dataType:"html",async:!1,success:function(t){var n=t,r=Mustache.to_html(n,APIdata.solrSearch.response.docs[e]);$("#results_container").append(r)}})}function favObjRemove(e){if(typeof userData.username_WSUDOR!="undefined"){var t=new Object;t.id=userData.username_WSUDOR+"_"+e;var n='{"delete":'+JSON.stringify(t)+"}";console.log(n);var r="http://silo.lib.wayne.edu/WSUAPI-dev?functions[]=solrRemoveDoc&raw="+n;console.log("URL to remove:",r);$.ajax({url:r,dataType:"json",success:i,error:s});function i(e){console.log(e);location.reload()}function s(e){console.log(e);alert("Could not remove favorite.")}}}var searchDefs={},mergedParams={};searchDefs.rows=10;searchDefs.start=0;searchDefs.wt="json";searchDefs.facet="true";searchDefs["facets[]"]=[];searchDefs["facets[]"].push("dc_date","dc_subject","dc_creator","dc_language","rels_hasContentModel","rels_isMemberOfCollection","dc_coverage");searchDefs["f.dc_date.facet.sort"]="index";searchDefs["fq[]"]=[];searchDefs["facet.mincount"]=1;searchDefs.fullView="";APIdata=new Object;