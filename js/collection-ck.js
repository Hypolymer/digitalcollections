// Javascript for collection view
// Variables
//////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Default Search Parameters
function collectionsCount(){function r(e){APIdata.collectionsCount=e;populateCollectionsView()}function i(e){console.log("collectionsCount Error");console.log(e)}var e=searchParams.q,t={rows:0,start:0,q:"*",facet:"true","facet.field":"rels_isMemberOfCollection"};t=JSON.stringify(t);var n="http://silo.lib.wayne.edu/WSUAPI/?functions[]=solrFacetSearch&solrParams="+t;$.ajax({url:n,dataType:"json",success:r,error:i})}function collectionsList(e){function r(t){APIdata.collectionsList=t;$(document).ready(function(){e=="collectionPage"?populateCollectionsList():e=="allCollections"&&collectionsCount()})}function i(e){console.log("API Call unsuccessful.  Back to the drawing board.")}var t={rows:100,start:0,wt:"json",sort:"id asc",q:"rels_hasContentModel:info:fedora/CM:Collection",raw:"escapeterms"};t=JSON.stringify(t);var n="http://silo.lib.wayne.edu/WSUAPI/?functions[]=solrSearch&solrParams="+t;$.ajax({url:n,dataType:"json",success:r,error:i})}function updatePage(){mergedParams.q=mergedParams.collection;var e=document.URL;updateNumbers();showFacets();paginationUpdate();$("#learn_more").html("<a href='singleObject.php?rendered=singleObject&id="+searchParams.id+"'>Learn more about this collection</a>");$("#rows").val(mergedParams.rows).prop("selected",!0)}function searchGo(e){function n(t){mix(t,APIdata);$(document).ready(function(){if(e=="collectionPage"){collectionsList("collectionPage");updateCollectionTitle();updatePage();populateFacets();mergedParams.q=="rels_hasContentModel:info:fedora/CM:Collection"?populateResults("templates/collectionResultObjAlt.htm",".collection_contents"):populateResults("templates/collectionResultObj.htm",".collection_contents")}else e=="allCollections"&&collectionsList("allCollections")})}function r(e){console.log("API Call unsuccessful.  Back to the drawing board.")}searchParams.q=searchParams.id;searchParams.q="rels_isMemberOfCollection:info:fedora/"+searchParams.q;searchParams.raw="escapeterms";searchParams["fq[]"]=searchParams.fq;delete searchParams.fq;mergedParams=jQuery.extend(!0,{},searchDefs,searchParams);debugSearchParams();solrParamsString=JSON.stringify(mergedParams);var t="http://silo.lib.wayne.edu/WSUAPI/?functions[]=solrSearch&solrParams="+solrParamsString;console.log(t);$.ajax({url:t,dataType:"json",success:n})}function updateCollectionTitle(){var e="info:fedora/"+searchParams.id;APIdata.solrTranslationHash[e]!=="undefined"?$("h2#collection_title").html(APIdata.solrTranslationHash[e]):$("h2#collection_title").html("Collection Title Unknown")}function updateCollection(){var e=document.URL;searchParams.q=$(".form-control").val();var t=updateURLParameter(window.location.href,"start",0),t=updateURLParameter(t,"collection",searchParams.q);window.location=t}function updateSearch(){var e=document.URL;searchParams.rows=$("#rows").val();var t=updateURLParameter(window.location.href,"rows",searchParams.rows);window.location=t}function populateResults(e,t){for(var n=0;n<APIdata.solrSearch.response.docs.length;n++)$.ajax({url:e,dataType:"html",async:!1,success:function(e){var r=e,s=Mustache.to_html(r,APIdata.solrSearch.response.docs[n]);$(t).append(s)}})}function populateCollectionsView(){for(var e=0;e<APIdata.collectionsList.solrSearch.response.docs.length;e++){var t=APIdata.collectionsList.solrSearch.response.docs[e].id;t="info:fedora/"+t;$(APIdata.collectionsCount.solrFacetSearch[t]).length&&(APIdata.collectionsList.solrSearch.response.docs[e].count=APIdata.collectionsCount.solrFacetSearch[t]);$.ajax({url:"templates/collectionsViewObj.htm",dataType:"html",async:!1,success:function(t){var n=t,r=Mustache.to_html(n,APIdata.collectionsList.solrSearch.response.docs[e]);$(".collection_contents").append(r)}})}}var searchDefs={},mergedParams={};searchDefs.rows=24;searchDefs.start=0;searchDefs.wt="json";searchDefs.fl="id dc_title";searchDefs.sort="id asc";searchDefs.facet="true";searchDefs["facets[]"]=[];searchDefs["facets[]"].push("facet_mods_year","dc_subject","dc_creator","dc_language","rels_hasContentModel","dc_coverage");searchDefs["f.facet_mods_year.facet.sort"]="index";searchDefs["fq[]"]=[];searchDefs["facet.mincount"]=1;APIdata=new Object;var type="";